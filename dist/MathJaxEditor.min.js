!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MathJaxEditor=t():e.MathJaxEditor=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Array.prototype.slice.call(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return-1!==e.indexOf(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["MSPACE","MATH"]},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(n(4));n(17),e.exports=r.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(5)),o=r(n(16)),u=(r(n(1)),function(){function e(t,n){i(this,e),this.core=new a.default(t,n),this.core.on("@input",this.insert.bind(this))}return s(e,[{key:"insertNumber",value:function(e){if(e<0||e>9)throw new RangeError("MathjaxEditor: The number must be 0 or up to 9.");var t=document.createElement("mn");t.innerHTML=e,this.core.insert(t)}},{key:"insertIdentifier",value:function(e){if("string"!=typeof e&&!e.match(/^[a-zA-Z]$/))throw new RangeError("MathjaxEditor: A single letter must be provided.");var t=document.createElement("mi");t.innerHTML=e,this.core.insert(t)}},{key:"insertFraction",value:function(){var e=document.createElement("mfrac"),t=document.createElement("mrow"),n=document.createElement("mrow");e.appendChild(t),e.appendChild(n),this.core.insert(e,t)}},{key:"insertSqrt",value:function(){var e=document.createElement("msqrt"),t=document.createElement("mrow");e.appendChild(t),this.core.insert(e,t)}},{key:"insertOperator",value:function(e){if(!o.default[e])throw new TypeError('MathjaxEditor: Unknown operator "'+e+'"');var t=document.createElement("mo");t.innerHTML=o.default[e],this.core.insert(t)}},{key:"insertSuperscript",value:function(){var e=document.createElement("msup"),t=document.createElement("mrow"),n=document.createElement("mrow");e.appendChild(t),e.appendChild(n),this.core.insert(e,t)}},{key:"insert",value:function(e){return e.match(/^[0-9]$/)?this.insertNumber(parseInt(e,10)):e.match(/^[a-zA-Z]$/)?this.insertIdentifier(e):o.default[e]?this.insertOperator(e):void console.warn('MathjaxEditor: insert: unknown "'+e+'"')}}]),e}());t.default=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(6)),o=r(n(9)),u=r(n(2)),l=r(n(11)),c=r(n(12)),h=r(n(13)),d=r(n(14)),f=r(n(1)),p=r(n(15)),m=r(n(0)),v=function(){function e(t,n){var r=this;i(this,e),this.$el=(0,c.default)(t),this.$math=document.createElement("math"),this.$math.setAttribute("id","e0"),this.$input=document.createElement("input"),this.$input.className="mathjax-editor-input",this.$container=document.createElement("div"),this.$container.className="mathjax-editor-container",this.$display=document.createElement("div"),this.$display.className="mathjax-editor-display",this.$cursor=document.createElement("div"),this.$cursor.className="mathjax-editor-cursor",this.$cursor.style.display="none",this.$display.appendChild(this.$math),this.$container.appendChild(this.$display),this.$container.appendChild(this.$input),this.$display.appendChild(this.$cursor),this.$el.parentNode.insertBefore(this.$container,this.$el.nextSibling),this.$el.style.display="none",this.cursor=null,this.eventEmitter=new l.default,this.isFocused=!1,this.jaxElement=null,this.flatMathTree=[],this.renderedElements=new a.default(this.$display),this.nextElementId=1,this.placeholder='<mtext class="mathjax-editor-placeholder">Start typing...</mtext>',this.cursorMover=new o.default(this.renderedElements),(0,h.default)(this.$display,function(e,t){r.jaxElement=e,r.$display.style.minHeight=(0,p.default)(t),r.updateJaxElement()}),this.blinkingInterval=setInterval(function(){r.$cursor.style.opacity="0"===r.$cursor.style.opacity?"1":"0"},500),this.$input.addEventListener("keydown",function(e){switch(e.which){case 13:return r.insertNewLine();case 37:return r.moveCursorLeft();case 39:return r.moveCursorRight();case 8:return r.backspaceRemove();case 46:return r.deleteRemove()}}),this.$display.addEventListener("click",this.handleClick.bind(this)),this.$input.addEventListener("keyup",this.handleInput.bind(this)),this.$input.addEventListener("keydown",this.handleInput.bind(this)),this.$input.addEventListener("focus",this.handleFocus.bind(this)),this.$input.addEventListener("blur",this.handleBlur.bind(this))}return s(e,[{key:"handleClick",value:function(e){var t=this,n=e.clientX,r=e.clientY;this.focus(),this.cursorMover.click(n,r,function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t.cursor=e,n&&t.moveCursorLeft(),r>1)for(r--;r--;)n?t.moveCursorLeft():t.moveCursorRight();else t.updateCursor()})}},{key:"handleFocus",value:function(){this.isFocused=!0,this.$display.classList.add("is-focused"),this.$cursor.style.display="block"}},{key:"handleBlur",value:function(){this.isFocused=!1,this.$display.classList.remove("is-focused"),this.$cursor.style.display="none"}},{key:"handleInput",value:function(){var e=this.$input.value.trim();e.length&&this.eventEmitter.emit("@input",e),this.$input.value=""}},{key:"updateCursor",value:function(){var e=void 0,t=!0;if(!this.cursor){var n=this.renderedElements.getLines()[0];return this.$display.appendChild(this.$cursor),this.$cursor.style.top=0,this.$cursor.style.height=(0,p.default)(n.height),void(this.$cursor.style.left=0)}if(!e)if((0,f.default)(u.default,this.cursor.tagName)){var r=this.renderedElements.findLine(this.cursor);e=this.renderedElements.findNextLine(r).getRendered(),t=!1}else t=!(e=this.renderedElements.findRendered(this.cursor)).classList.contains("mjx-mrow");if(!e)return console.log(this.cursor),console.warn("MathjaxEditor: Rendered element not found.");e.parentNode.appendChild(this.$cursor),this.$cursor.style.height=(0,p.default)(e.clientHeight),this.$cursor.style.top=(0,p.default)(e.offsetTop),this.$cursor.style.left=(0,p.default)(e.offsetLeft+(t?e.clientWidth:0))}},{key:"updateJaxElement",value:function(){var e=this;if(this.jaxElement){this.flattenMathTree();var t=(0,d.default)(this.$math,this.placeholder);this.jaxElement.Text(t,function(){e.renderedElements.update(e.flatMathTree),e.updateCursor()})}}},{key:"moveCursorLeft",value:function(){if(this.cursor){var e=this.flatMathTree.indexOf(this.cursor);this.cursor=this.flatMathTree[e-1],this.updateCursor()}}},{key:"moveCursorRight",value:function(){if(this.cursor){var e=this.flatMathTree.indexOf(this.cursor),t=this.flatMathTree[e+1];!t||"MATH"===t.tagName&&this.cursor.parentNode===t||(this.cursor=t)}else{var n=this.flatMathTree[1];"MATH"!==n.tagName&&(this.cursor=n)}this.updateCursor()}},{key:"backspaceRemove",value:function(){if(this.cursor){if("MROW"===this.cursor.tagName){var e=this.cursor.parentNode;e.parentNode.removeChild(e),this.cursor=e.previousSibling}else{var t=this.cursor.previousSibling?this.cursor.previousSibling:this.cursor.parentNode.previousSibling;this.cursor.parentNode.removeChild(this.cursor),this.cursor=t}this.updateJaxElement()}}},{key:"deleteRemove",value:function(){if(this.cursor)if(this.cursor.nextSibling)this.cursor.parentNode.removeChild(this.cursor.nextElementSibling);else{var e=this.cursor.parentNode;"MROW"===e.tagName?(this.cursor=e.parentNode.previousElementSibling,e.parentNode.parentNode.removeChild(e.parentNode)):e.parentNode.removeChild(e)}else this.$math.removeChild(this.$math.firstElementChild);this.updateJaxElement()}},{key:"insert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.cursor?"MROW"===this.cursor.tagName?this.cursor.insertBefore(e,this.cursor.firstChild):"MATH"===this.cursor.tagName?this.$math.appendChild(e):this.cursor.parentNode.insertBefore(e,this.cursor.nextSibling):this.$math.insertBefore(e,this.$math.firstChild),this.cursor=t||e,this.updateJaxElement(),this.focus()}},{key:"insertNewLine",value:function(){if(!this.cursor||"MATH"===this.cursor.tagName||"MATH"===this.cursor.parentNode.tagName){var e=document.createElement("mspace");e.setAttribute("linebreak","newline"),this.insert(e)}}},{key:"flattenMathTree",value:function(){var e=this,t=[null],n=function n(r){var i=(0,m.default)(r.children);if(r.hasAttribute("id")||r.setAttribute("id","e"+e.nextElementId++),t.push(r),i.forEach(function(e){return n(e)}),i.length&&"MROW"!==r.tagName){var s=t.indexOf(r);t.splice(s,1),t.push(r)}};(0,m.default)(this.$math.children).forEach(function(e){return n(e)}),t.push(this.$math),this.flatMathTree=t}},{key:"on",value:function(e,t){this.eventEmitter.on(e,t)}},{key:"focus",value:function(){this.$input.focus()}}]),e}();t.default=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(7)),o=r(n(8)),u=(r(n(2)),r(n(0))),l=function(){function e(t){i(this,e),this.$display=t,this.elements=[],this.lines=[]}return s(e,[{key:"findElements",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;if(u){var l=u.getAttribute("id"),c=this.$display.querySelector("#"+l);if(!c)throw new Error("MathjaxEditor: Rendered element not found. (id: "+l+").");t.push(new a.default(u,c))}}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return t}},{key:"findLines",value:function(e){var t=e.filter(function(e){return e&&"MSPACE"===e.tagName}),n=(0,u.default)(this.$display.querySelectorAll(".mjx-block")),r=[],i=e[e.lenght-1];if(t.length)for(var s=n.length,a=0;a<s;a++){var l=n[a],c=t[a],h=t[a-1],d=new o.default(c||i,l.firstElementChild);d.$firstEl=h?h.previousElementSibling:null,d.$lastEl=c?c.previousElementSibling:e[e.length-2],r.push(d)}else{var f=new o.default(i,this.$display.querySelector(".mjx-math"));f.$firstEl=null,f.$lastEl=e[e.length-2],r.push(f)}return r}},{key:"update",value:function(e){this.lines=this.findLines(e),this.elements=this.findElements(e)}},{key:"findRendered",value:function(e){var t=this.elements.find(function(t){return t.getNode()===e});return t?t.getRendered():null}},{key:"findLine",value:function(e){var t=this.lines.find(function(t){return t.getNode()===e});return t||null}},{key:"findNextLine",value:function(e){var t=this.lines.indexOf(e);return this.lines[t+1]||null}},{key:"forEach",value:function(e){return this.elements.forEach(e)}},{key:"getElements",value:function(){return this.elements}},{key:"getLines",value:function(){return this.lines}}]),e}();t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(t,n){r(this,e);var i=n.getBoundingClientRect();this.$el=t,this.$rendered=n,this.width=i.width,this.height=i.height,this.x1=i.left,this.x2=i.right,this.y1=i.top,this.y2=i.bottom,this.cx=this.x1+this.width/2,this.cy=this.y1+this.height/2}return i(e,[{key:"getTag",value:function(){return this.$el.tagName}},{key:"isTag",value:function(e){return this.getTag().toLowerCase()===e.toLowerCase()}},{key:"hasChildren",value:function(){return!!this.$el.children.length}},{key:"getRendered",value:function(){return this.$rendered}},{key:"getNode",value:function(){return this.$el}},{key:"pointIn",value:function(e,t){return e>this.x1&&e<this.x2&&t>this.y1&&t<this.y2}},{key:"distanceTo",value:function(e,t){return Math.sqrt(Math.pow(e-this.cx,2)+Math.pow(t-this.cy,2))}},{key:"isLeftSide",value:function(e){return!this.isTag("mrow")&&this.cx>e}}]),e}();t.default=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(t,n){r(this,e);var i=n.getBoundingClientRect();this.$el=t,this.$rendered=n,this.width=i.width,this.height=i.height,this.x1=i.left,this.x2=i.right,this.y1=i.top,this.y2=i.bottom,this.$firstEl=null,this.$lastEl=null}return i(e,[{key:"getNode",value:function(){return this.$el}},{key:"getRendered",value:function(){return this.$rendered}},{key:"betweenYAxis",value:function(e){return e>this.y1&&e<this.y2}},{key:"betweenXAxis",value:function(e){return e>this.x1&&e<this.x2}}]),e}();t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(10)),o=r(n(1)),u=function(){function e(t){i(this,e),this.renderedElements=t,this.lastCandidate=null}return s(e,[{key:"click",value:function(e,t,n){var r=null,i=1/0,s=1,u=!0,l=!1,c=void 0;try{for(var h,d=this.renderedElements.getLines()[Symbol.iterator]();!(u=(h=d.next()).done);u=!0){var f=h.value;if(f.betweenYAxis(t)&&!f.betweenXAxis(e))return e>f.x2?n(f.$lastEl,!1):n(f.$firstEl,!0)}}catch(e){l=!0,c=e}finally{try{!u&&d.return&&d.return()}finally{if(l)throw c}}var p=!0,m=!1,v=void 0;try{for(var y,g=this.renderedElements.getElements()[Symbol.iterator]();!(p=(y=g.next()).done);p=!0){var x=y.value;if(!(0,o.default)(a.default,x.getTag()))if(x.isTag("mrow")){if(x.hasChildren())continue;if(x.pointIn(e,t)){r=x;break}}else{var b=x.distanceTo(e,t);i>b&&(i=b,r=x)}}}catch(e){m=!0,v=e}finally{try{!p&&g.return&&g.return()}finally{if(m)throw v}}r===this.lastCandidate?(s=2,this.lastCandidate=null):this.lastCandidate=r,r?n(r.getNode(),r.isLeftSide(e),s):n(null)}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["MATH","MSQRT","MFRAC"]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){r(this,e),this.handlers={}}return i(e,[{key:"on",value:function(e,t){this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)}},{key:"emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.handlers[e]&&this.handlers[e].forEach(function(e){return e.apply(void 0,n)})}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t="string"==typeof e?document.querySelector(e):1===e.nodeType?e:null;if(!t)throw new ReferenceError("MathjaxEditor: Target TEXTAREA was not found.");if("TEXTAREA"!==t.tagName)throw new TypeError("MathjaxEditor: Target element must be a TEXTAREA.");return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){MathJax.Hub.Config({displayAlign:"left"}),MathJax.Hub.Queue(["Typeset",MathJax.Hub,e,function(){var n=MathJax.Hub.getAllJax(e)[0];n.Text("<math><mo>...</mo></math>",function(){t(n,e.clientHeight-8)})}])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.cloneNode(!0);return n.children.length||(n.innerHTML=t),(0,r.default)(n.querySelectorAll("mrow")).forEach(function(e){if(!e.children.length){var t=document.createElement("mo");t.className="mathjax-editor-placeholder",t.innerHTML="?",e.appendChild(t)}}),(0,r.default)(n.querySelectorAll("mspace")).forEach(function(e){var t=e.previousElementSibling,n=e.nextElementSibling,r=document.createElement("mo");r.className="mathjax-editor-newline-empty",r.innerHTML="⏎",n&&"MATH"!==n.tagName||e.parentNode.insertBefore(r,e.nextSibling),t&&"MSPACE"!==t.tagName||e.parentNode.insertBefore(r.cloneNode(!0),e)}),n.outerHTML};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e+"px"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={"+":"+","-":"-","=":"=","*":"&#x22C5;\x3c!-- ⋅ --\x3e","/":"&#x00F7;\x3c!-- ÷ --\x3e",div:"&#x00F7;\x3c!-- ÷ --\x3e",times:"&#x00D7;\x3c!-- × --\x3e",cdot:"&#x22C5;\x3c!-- ⋅ --\x3e",pm:"&#x00B1;\x3c!-- ± --\x3e"}},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(n(18));window.addEventListener("load",function(){if(!MathJax)throw new Error("MathjaxEditor: MathJax is missing.");MathJax.Hub.processSectionDelay=0,MathJax.Ajax.Styles(r.default)})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={".mathjax-editor-input":{left:"-100%",position:"absolute",top:"-100%"},".mathjax-editor-container":{position:"relative"},".mathjax-editor-display":{"background-color":"#fff",cursor:"text","-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"},".mathjax-editor-display .mjx-chtml":{outline:"none !important"},".mathjax-editor-cursor":{"background-color":"#000",position:"absolute",width:"1px"},".mathjax-editor-newline-empty":{opacity:.2},".mathjax-editor-placeholder":{color:"#ccc"}}}])});